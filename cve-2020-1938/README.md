# CVE-2020-1938 (Ghostcat) — PoC repository

Breve repository di laboratorio che contiene una PoC AJP client per testare CVE-2020-1938 (Ghostcat).
Usare SOLO in ambiente di laboratorio controllato.

## Struttura
- `exploit.py` — PoC AJP client che tenta di leggere file sotto la webapp tramite include attributes.
- `docker/` o `docker-compose.yml` (opzionale) — suggerito per avviare un Tomcat vulnerabile.
- `webroot/WEB-INF/flag.txt` — esempio di file da leggere.

## Prerequisiti
- Linux (i comandi seguenti sono pensati per Linux)
- Python 3
- Docker & docker-compose (opzionale, consigliato per il laboratorio)

## Preparare l'ambiente con Docker (consigliato)
Opzione A — docker run rapido:
```bash
# nella root del repo
mkdir -p webroot/WEB-INF
echo "FLAG{ghostcat_test_flag_2025}" > webroot/WEB-INF/flag.txt

docker run -d --name tomcat_vuln -p 8080:8080 -p 8009:8009 \
  -v "$PWD/webroot":/usr/local/tomcat/webapps/ROOT \
  tomcat:9.0 \
  sh -c "sed -i 's/secretRequired=\"true\"/secretRequired=\"false\"/' /usr/local/tomcat/conf/server.xml && catalina.sh run"
```

Opzione B — docker-compose (se preferisci creare `docker-compose.yml`):
```bash
# crea docker-compose.yml come nel repo e poi:
docker-compose up -d
```

Verifiche:
```bash
docker ps
docker exec -it tomcat_vuln ls -l /usr/local/tomcat/webapps/ROOT/WEB-INF
docker exec -it tomcat_vuln cat /usr/local/tomcat/webapps/ROOT/WEB-INF/flag.txt
docker logs tomcat_vuln --tail 200
```

> Nota: alcune versioni di Tomcat non accettano `secretRequired="false"` via sed come mostrato nei log warning; l'esempio usa immagini datate per scopi di laboratorio.

## Eseguire la PoC
Dal folder del progetto:
```bash
python3 exploit.py 127.0.0.1 8009
```
Output atteso: tentativi su percorsi in `CANDIDATES`. Se la PoC trova la flag stampa:
```
[+] FLAG found: FLAG{...}
```

## Modifiche utili
- Aggiungere nuovi percorsi da provare: modifica la lista `CANDIDATES` in `exploit.py`.
- Timeout/porta: modifica `TIMEOUT`, `HOST`, `PORT` oppure passa host/port da CLI:
  `python3 exploit.py <host> <port>`
- Verbosità / raw response: puoi stampare `resp` grezzo in `try_path` per debug.

## Pulizia
```bash
docker stop tomcat_vuln
docker rm tomcat_vuln
# oppure
docker-compose down
```

## Sicurezza e legalità
Questa PoC è fornita solo per uso didattico e di laboratorio. Non testare o usare questi strumenti su sistemi per i quali non hai esplicita autorizzazione.

## Riferimenti
- CVE-2020-1938 (Ghostcat) — documentazione e advisories pubbliche.
- Specifiche AJP / implementazione Tomcat.